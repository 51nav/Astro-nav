---
/**
 * Week 3 åŸºç¡€é›†æˆæµ‹è¯•é¡µé¢
 * ä»»åŠ¡1.4: ç»¼åˆæµ‹è¯•ConfigManagerã€LazyLoaderã€LoadingIndicatorçš„é›†æˆ
 */

import LoadingIndicator from '../components/LoadingIndicator.astro';
import { ConfigManager } from '../utils/ConfigManager';
import { LazyLoader } from '../utils/LazyLoader';

// æµ‹è¯•ç»“æœæ¥å£
interface TestResult {
  name: string;
  success: boolean;
  duration: number;
  details: any;
  error?: string;
}

interface PerformanceMetrics {
  configLoadTime: number;
  categoryLoadTime: number;
  cacheHitTime: number;
  totalTestTime: number;
}

async function runTest(name: string, testFn: () => Promise<any>): Promise<TestResult> {
  const startTime = performance.now();
  try {
    const result = await testFn();
    return {
      name,
      success: true,
      duration: performance.now() - startTime,
      details: result
    };
  } catch (error) {
    return {
      name,
      success: false,
      duration: performance.now() - startTime,
      details: {},
      error: error instanceof Error ? error.message : 'æœªçŸ¥é”™è¯¯'
    };
  }
}

// åˆå§‹åŒ–ç»„ä»¶
const configManager = new ConfigManager();
const lazyLoader = new LazyLoader(configManager);

// æ€§èƒ½æŒ‡æ ‡æ”¶é›†
const performanceMetrics: PerformanceMetrics = {
  configLoadTime: 0,
  categoryLoadTime: 0,
  cacheHitTime: 0,
  totalTestTime: 0
};

const totalStartTime = performance.now();

// æ‰§è¡Œç»¼åˆé›†æˆæµ‹è¯•
const testResults: TestResult[] = [
  // æµ‹è¯•1: ä¼˜åŒ–æ ¼å¼æ£€æµ‹
  await runTest('ä¼˜åŒ–æ ¼å¼æ£€æµ‹', async () => {
    const startTime = performance.now();
    const result = await configManager.loadOptimizedConfig();
    performanceMetrics.configLoadTime = performance.now() - startTime;
    
    return {
      success: result.success,
      isOptimized: result.isOptimized,
      loadTime: performanceMetrics.configLoadTime,
      hasConfig: !!result.config,
      categoryCount: result.config?.optimization?.totalCategories || 0,
      compressionRatio: result.config?.optimization?.compressionRatio || 0
    };
  }),

  // æµ‹è¯•2: åˆ†ç±»æ•°æ®æ‡’åŠ è½½
  await runTest('åˆ†ç±»æ•°æ®æ‡’åŠ è½½', async () => {
    const indexes = configManager.getAllCategoryIndexes();
    if (indexes.length === 0) {
      throw new Error('æ²¡æœ‰å¯ç”¨çš„åˆ†ç±»ç´¢å¼•');
    }
    
    const testIndex = indexes[0];
    const startTime = performance.now();
    const result = await lazyLoader.loadCategory(testIndex);
    performanceMetrics.categoryLoadTime = performance.now() - startTime;
    
    return {
      categoryIndex: testIndex,
      success: result.success,
      fromCache: result.fromCache,
      loadTime: performanceMetrics.categoryLoadTime,
      hasData: !!result.data,
      siteCount: result.data?.sites?.length || 0,
      categoryName: result.data?.categoryName || ''
    };
  }),

  // æµ‹è¯•3: ç¼“å­˜æœºåˆ¶éªŒè¯
  await runTest('ç¼“å­˜æœºåˆ¶éªŒè¯', async () => {
    const indexes = configManager.getAllCategoryIndexes();
    const testIndex = indexes[0];
    
    // ç¬¬äºŒæ¬¡åŠ è½½åŒä¸€åˆ†ç±» (åº”è¯¥ä»ç¼“å­˜è·å–)
    const startTime = performance.now();
    const result = await lazyLoader.loadCategory(testIndex);
    performanceMetrics.cacheHitTime = performance.now() - startTime;
    
    const stats = lazyLoader.getCacheStats();
    
    return {
      fromCache: result.fromCache,
      cacheHitTime: performanceMetrics.cacheHitTime,
      cacheSize: stats.cacheSize,
      cacheWorking: result.fromCache && performanceMetrics.cacheHitTime < 10, // ç¼“å­˜åº”è¯¥å¾ˆå¿«
      cacheStats: stats
    };
  }),

  // æµ‹è¯•4: é”™è¯¯å¤„ç†æµ‹è¯•
  await runTest('é”™è¯¯å¤„ç†æµ‹è¯•', async () => {
    // æµ‹è¯•æ— æ•ˆåˆ†ç±»ç´¢å¼•
    const invalidResult = await lazyLoader.loadCategory(-1);
    
    // æµ‹è¯•ç©ºé…ç½®æƒ…å†µ
    const emptyConfigManager = new ConfigManager();
    const emptyResult = await emptyConfigManager.loadCategoryData(0);
    
    return {
      invalidIndexHandled: !invalidResult.success,
      invalidIndexError: invalidResult.error,
      emptyConfigHandled: !emptyResult.success,
      emptyConfigError: emptyResult.error,
      gracefulDegradation: true
    };
  }),

  // æµ‹è¯•5: æ‰¹é‡åŠ è½½æ€§èƒ½
  await runTest('æ‰¹é‡åŠ è½½æ€§èƒ½', async () => {
    const indexes = configManager.getAllCategoryIndexes();
    const testIndexes = indexes.slice(0, Math.min(3, indexes.length));
    
    const startTime = performance.now();
    const results = await lazyLoader.loadMultipleCategories(testIndexes);
    const batchLoadTime = performance.now() - startTime;
    
    const successCount = Array.from(results.values()).filter(r => r.success).length;
    
    return {
      requestedCount: testIndexes.length,
      successCount,
      batchLoadTime,
      avgTimePerCategory: batchLoadTime / testIndexes.length,
      allSuccessful: successCount === testIndexes.length,
      results: Array.from(results.entries()).map(([index, result]) => ({
        categoryIndex: index,
        success: result.success,
        fromCache: result.fromCache
      }))
    };
  }),

  // æµ‹è¯•6: å†…å­˜ä½¿ç”¨ç›‘æ§
  await runTest('å†…å­˜ä½¿ç”¨ç›‘æ§', async () => {
    const stats = lazyLoader.getCacheStats();
    
    // æ¸…ç†è¿‡æœŸç¼“å­˜æµ‹è¯•
    const cleanedCount = lazyLoader.cleanExpiredCache();
    
    // è·å–é…ç½®ç®¡ç†å™¨çŠ¶æ€
    const configInfo = {
      isOptimized: configManager.isOptimizedMode(),
      categoryCount: configManager.getAllCategoryIndexes().length,
      hasConfig: configManager.hasConfig()
    };
    
    return {
      cacheStats: stats,
      cleanedCacheCount: cleanedCount,
      configManagerState: configInfo,
      memoryEfficient: stats.cacheSize <= 10, // ç¼“å­˜å¤§å°æ§åˆ¶
      performanceOptimal: true
    };
  }),

  // æµ‹è¯•7: ç«¯åˆ°ç«¯ç”¨æˆ·ä½“éªŒ
  await runTest('ç«¯åˆ°ç«¯ç”¨æˆ·ä½“éªŒ', async () => {
    // æ¨¡æ‹Ÿå®Œæ•´çš„ç”¨æˆ·æ“ä½œæµç¨‹
    const userFlow = {
      step1: 'åŠ è½½é…ç½®',
      step2: 'é€‰æ‹©åˆ†ç±»',
      step3: 'åŠ è½½æ•°æ®',
      step4: 'ç¼“å­˜éªŒè¯',
      step5: 'åˆ‡æ¢åˆ†ç±»'
    };
    
    // 1. é…ç½®åŠ è½½
    const configResult = await configManager.loadOptimizedConfig();
    
    // 2. è·å–åˆ†ç±»åˆ—è¡¨
    const categories = configManager.getAllCategoryIndexes();
    
    // 3. åŠ è½½ç¬¬ä¸€ä¸ªåˆ†ç±»
    const firstResult = categories.length > 0 ? 
      await lazyLoader.loadCategory(categories[0]) : null;
    
    // 4. åˆ‡æ¢åˆ°ç¬¬äºŒä¸ªåˆ†ç±»
    const secondResult = categories.length > 1 ? 
      await lazyLoader.loadCategory(categories[1]) : null;
    
    return {
      userFlow,
      configLoaded: configResult.success,
      categoriesAvailable: categories.length,
      firstCategoryLoaded: firstResult?.success || false,
      secondCategoryLoaded: secondResult?.success || false,
      userExperienceSmooth: configResult.success && categories.length > 0,
      totalSteps: Object.keys(userFlow).length,
      completedSteps: [
        configResult.success,
        categories.length > 0,
        firstResult?.success,
        secondResult?.success
      ].filter(Boolean).length
    };
  }),

  // æµ‹è¯•8: æ€§èƒ½åŸºå‡†éªŒè¯
  await runTest('æ€§èƒ½åŸºå‡†éªŒè¯', async () => {
    const benchmarks = {
      configLoadTime: performanceMetrics.configLoadTime,
      categoryLoadTime: performanceMetrics.categoryLoadTime,
      cacheHitTime: performanceMetrics.cacheHitTime,
      totalTestTime: performance.now() - totalStartTime
    };
    
    // æ€§èƒ½åŸºå‡†æ£€æŸ¥
    const benchmarkResults = {
      configLoadFast: benchmarks.configLoadTime < 1000, // é…ç½®åŠ è½½ < 1ç§’
      categoryLoadFast: benchmarks.categoryLoadTime < 2000, // åˆ†ç±»åŠ è½½ < 2ç§’
      cacheHitFast: benchmarks.cacheHitTime < 10, // ç¼“å­˜å‘½ä¸­ < 10ms
      totalTimeFast: benchmarks.totalTestTime < 10000 // æ€»æµ‹è¯•æ—¶é—´ < 10ç§’
    };
    
    performanceMetrics.totalTestTime = benchmarks.totalTestTime;
    
    return {
      benchmarks,
      benchmarkResults,
      allBenchmarksPassed: Object.values(benchmarkResults).every(Boolean),
      performanceGrade: Object.values(benchmarkResults).filter(Boolean).length >= 3 ? 'A' : 'B'
    };
  })
];

const successCount = testResults.filter(r => r.success).length;
const totalTests = testResults.length;
const successRate = (successCount / totalTests * 100).toFixed(1);

// è®¡ç®—æ€»ä½“æ€§èƒ½è¯„åˆ†
const performanceScore = Math.round(
  (performanceMetrics.configLoadTime < 1000 ? 25 : 0) +
  (performanceMetrics.categoryLoadTime < 2000 ? 25 : 0) +
  (performanceMetrics.cacheHitTime < 10 ? 25 : 0) +
  (parseFloat(successRate) >= 90 ? 25 : 0)
);
---

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Week 3 åŸºç¡€é›†æˆæµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
      line-height: 1.6;
    }
    
    .header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0 0 10px 0;
      font-size: 2.5em;
      font-weight: 700;
    }
    
    .header .subtitle {
      font-size: 1.2em;
      opacity: 0.9;
    }
    
    .dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .metric-card {
      background: white;
      padding: 25px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
      border-left: 4px solid #3b82f6;
    }
    
    .metric-card.success {
      border-left-color: #10b981;
    }
    
    .metric-card.warning {
      border-left-color: #f59e0b;
    }
    
    .metric-card.error {
      border-left-color: #ef4444;
    }
    
    .metric-value {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .metric-label {
      color: #6b7280;
      font-size: 0.9em;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .performance-panel {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
    }
    
    .performance-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .performance-item {
      text-align: center;
      padding: 20px;
      background: #f8fafc;
      border-radius: 8px;
    }
    
    .performance-time {
      font-size: 1.8em;
      font-weight: bold;
      color: #3b82f6;
    }
    
    .performance-desc {
      color: #6b7280;
      font-size: 0.9em;
      margin-top: 5px;
    }
    
    .test-results {
      display: grid;
      gap: 20px;
    }
    
    .test-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.2s ease;
    }
    
    .test-card:hover {
      transform: translateY(-2px);
    }
    
    .test-header {
      padding: 20px;
      border-bottom: 1px solid #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .test-header.success {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
      color: #065f46;
    }
    
    .test-header.error {
      background: linear-gradient(135deg, #fee2e2, #fecaca);
      color: #991b1b;
    }
    
    .test-name {
      font-size: 1.2em;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .test-duration {
      font-size: 0.9em;
      opacity: 0.8;
      background: rgba(255,255,255,0.2);
      padding: 4px 8px;
      border-radius: 4px;
    }
    
    .test-content {
      padding: 20px;
    }
    
    .test-details {
      background: #f8fafc;
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }
    
    .test-details pre {
      margin: 0;
      font-size: 0.85em;
      white-space: pre-wrap;
      word-break: break-word;
      color: #374151;
    }
    
    .error-message {
      background: #fef2f2;
      color: #991b1b;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      border-left: 4px solid #ef4444;
    }
    
    .loading-demo {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 30px;
      text-align: center;
    }
    
    .demo-controls {
      margin-top: 20px;
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }
    
    .demo-controls button {
      padding: 10px 20px;
      border: 1px solid #d1d5db;
      background: white;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .demo-controls button:hover {
      background: #f3f4f6;
      border-color: #9ca3af;
    }
    
    .demo-controls button.active {
      background: #3b82f6;
      color: white;
      border-color: #3b82f6;
    }
    
    .status-indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-indicator.success {
      background: #10b981;
    }
    
    .status-indicator.error {
      background: #ef4444;
    }
    
    .status-indicator.warning {
      background: #f59e0b;
    }
    
    @media (max-width: 768px) {
      .dashboard {
        grid-template-columns: 1fr;
      }
      
      .performance-grid {
        grid-template-columns: 1fr;
      }
      
      .header h1 {
        font-size: 2em;
      }
      
      .demo-controls {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ğŸ§ª Week 3 åŸºç¡€é›†æˆæµ‹è¯•</h1>
    <div class="subtitle">
      ä»»åŠ¡1.4: ConfigManager + LazyLoader + LoadingIndicator ç»¼åˆéªŒè¯<br>
      æµ‹è¯•æ—¶é—´: {new Date().toLocaleString()}
    </div>
  </div>

  <!-- ä»ªè¡¨æ¿ -->
  <div class="dashboard">
    <div class={`metric-card ${successRate === '100.0' ? 'success' : successRate === '0.0' ? 'error' : 'warning'}`}>
      <div class="metric-value">{successRate}%</div>
      <div class="metric-label">æµ‹è¯•é€šè¿‡ç‡</div>
    </div>
    <div class="metric-card">
      <div class="metric-value">{performanceScore}</div>
      <div class="metric-label">æ€§èƒ½è¯„åˆ†</div>
    </div>
    <div class="metric-card">
      <div class="metric-value">{successCount}/{totalTests}</div>
      <div class="metric-label">é€šè¿‡/æ€»æ•°</div>
    </div>
    <div class="metric-card">
      <div class="metric-value">{(performanceMetrics.totalTestTime / 1000).toFixed(1)}s</div>
      <div class="metric-label">æ€»æµ‹è¯•æ—¶é—´</div>
    </div>
  </div>

  <!-- æ€§èƒ½ç›‘æ§é¢æ¿ -->
  <div class="performance-panel">
    <h2>ğŸ“Š æ€§èƒ½ç›‘æ§é¢æ¿</h2>
    <div class="performance-grid">
      <div class="performance-item">
        <div class="performance-time">{performanceMetrics.configLoadTime.toFixed(0)}ms</div>
        <div class="performance-desc">é…ç½®åŠ è½½æ—¶é—´</div>
        <div class="status-indicator {performanceMetrics.configLoadTime < 1000 ? 'success' : 'warning'}"></div>
      </div>
      <div class="performance-item">
        <div class="performance-time">{performanceMetrics.categoryLoadTime.toFixed(0)}ms</div>
        <div class="performance-desc">åˆ†ç±»åŠ è½½æ—¶é—´</div>
        <div class="status-indicator {performanceMetrics.categoryLoadTime < 2000 ? 'success' : 'warning'}"></div>
      </div>
      <div class="performance-item">
        <div class="performance-time">{performanceMetrics.cacheHitTime.toFixed(1)}ms</div>
        <div class="performance-desc">ç¼“å­˜å‘½ä¸­æ—¶é—´</div>
        <div class="status-indicator {performanceMetrics.cacheHitTime < 10 ? 'success' : 'warning'}"></div>
      </div>
      <div class="performance-item">
        <div class="performance-time">{(performanceMetrics.totalTestTime / 1000).toFixed(1)}s</div>
        <div class="performance-desc">æ€»æµ‹è¯•æ—¶é—´</div>
        <div class="status-indicator {performanceMetrics.totalTestTime < 10000 ? 'success' : 'warning'}"></div>
      </div>
    </div>
  </div>

  <!-- åŠ è½½çŠ¶æ€æ¼”ç¤º -->
  <div class="loading-demo">
    <h2>â³ åŠ è½½çŠ¶æ€æ¼”ç¤º</h2>
    <div id="loading-demo-area">
      <LoadingIndicator 
        isLoading={false}
        type="spinner" 
        size="medium" 
        message="ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å§‹æ¼”ç¤º" 
      />
    </div>
    <div class="demo-controls">
      <button onclick="demoConfigLoad()">é…ç½®åŠ è½½</button>
      <button onclick="demoCategoryLoad()">åˆ†ç±»åŠ è½½</button>
      <button onclick="demoCacheHit()">ç¼“å­˜å‘½ä¸­</button>
      <button onclick="demoError()">é”™è¯¯å¤„ç†</button>
      <button onclick="demoSuccess()">åŠ è½½å®Œæˆ</button>
    </div>
  </div>

  <!-- æµ‹è¯•ç»“æœ -->
  <div class="test-results">
    {testResults.map((result, index) => (
      <div class="test-card">
        <div class={`test-header ${result.success ? 'success' : 'error'}`}>
          <div class="test-name">
            <span>{result.success ? 'âœ…' : 'âŒ'}</span>
            é›†æˆæµ‹è¯• {index + 1}: {result.name}
          </div>
          <div class="test-duration">{result.duration.toFixed(2)}ms</div>
        </div>
        <div class="test-content">
          <div class="test-details">
            <strong>æµ‹è¯•è¯¦æƒ…:</strong>
            <pre>{JSON.stringify(result.details, null, 2)}</pre>
          </div>
          {result.error && (
            <div class="error-message">
              <strong>é”™è¯¯ä¿¡æ¯:</strong> {result.error}
            </div>
          )}
        </div>
      </div>
    ))}
  </div>

  <script define:vars={{ testResults, performanceMetrics }}>
    console.log('ğŸ§ª Week 3 åŸºç¡€é›†æˆæµ‹è¯•é¡µé¢å·²åŠ è½½');
    console.log('ğŸ“Š æµ‹è¯•ç»“æœ:', JSON.stringify(testResults, null, 2));
    console.log('âš¡ æ€§èƒ½æŒ‡æ ‡:', JSON.stringify(performanceMetrics, null, 2));

    // æ¼”ç¤ºå‡½æ•°
    function demoConfigLoad() {
      const area = document.getElementById('loading-demo-area');
      area.innerHTML = `
        <div class="loading-indicator loading-medium loading-spinner">
          <div class="loading-content">
            <div class="loading-spinner">
              <div class="spinner-ring"></div>
              <div class="spinner-ring"></div>
              <div class="spinner-ring"></div>
              <div class="spinner-ring"></div>
            </div>
            <div class="loading-message">æ­£åœ¨åŠ è½½é…ç½®æ–‡ä»¶...</div>
          </div>
        </div>
      `;
      
      setTimeout(() => {
        area.innerHTML = '<div style="color: #10b981; font-size: 1.2em;">âœ… é…ç½®åŠ è½½å®Œæˆ (ä¼˜åŒ–æ ¼å¼æ£€æµ‹æˆåŠŸ)</div>';
      }, 2000);
    }

    function demoCategoryLoad() {
      const area = document.getElementById('loading-demo-area');
      let progress = 0;
      
      const interval = setInterval(() => {
        progress += 25;
        area.innerHTML = `
          <div class="loading-indicator loading-medium loading-progress">
            <div class="loading-content">
              <div class="loading-progress">
                <div class="progress-bar">
                  <div class="progress-fill" style="width: ${progress}%"></div>
                </div>
                <div class="progress-text">${progress}%</div>
              </div>
              <div class="loading-message">æ­£åœ¨åŠ è½½åˆ†ç±»æ•°æ®...</div>
            </div>
          </div>
        `;
        
        if (progress >= 100) {
          clearInterval(interval);
          setTimeout(() => {
            area.innerHTML = '<div style="color: #10b981; font-size: 1.2em;">âœ… åˆ†ç±»æ•°æ®åŠ è½½å®Œæˆ</div>';
          }, 500);
        }
      }, 400);
    }

    function demoCacheHit() {
      const area = document.getElementById('loading-demo-area');
      area.innerHTML = `
        <div class="loading-indicator loading-medium loading-dots">
          <div class="loading-content">
            <div class="loading-dots">
              <div class="dot dot-1"></div>
              <div class="dot dot-2"></div>
              <div class="dot dot-3"></div>
            </div>
            <div class="loading-message">æ£€æŸ¥ç¼“å­˜...</div>
          </div>
        </div>
      `;
      
      setTimeout(() => {
        area.innerHTML = '<div style="color: #10b981; font-size: 1.2em;">âš¡ ç¼“å­˜å‘½ä¸­ï¼æ•°æ®å·²ä»ç¼“å­˜åŠ è½½</div>';
      }, 300);
    }

    function demoError() {
      const area = document.getElementById('loading-demo-area');
      area.innerHTML = `
        <div class="loading-indicator loading-medium loading-spinner">
          <div class="loading-content">
            <div class="loading-spinner">
              <div class="spinner-ring"></div>
              <div class="spinner-ring"></div>
              <div class="spinner-ring"></div>
              <div class="spinner-ring"></div>
            </div>
            <div class="loading-message">æ­£åœ¨åŠ è½½...</div>
          </div>
        </div>
      `;
      
      setTimeout(() => {
        area.innerHTML = '<div style="color: #ef4444; font-size: 1.2em;">âŒ åŠ è½½å¤±è´¥ï¼Œæ­£åœ¨é‡è¯•...</div>';
        
        setTimeout(() => {
          area.innerHTML = '<div style="color: #10b981; font-size: 1.2em;">âœ… é‡è¯•æˆåŠŸï¼</div>';
        }, 1500);
      }, 1500);
    }

    function demoSuccess() {
      const area = document.getElementById('loading-demo-area');
      area.innerHTML = `
        <div style="color: #10b981; font-size: 1.5em; text-align: center; padding: 20px;">
          <div style="font-size: 3em; margin-bottom: 10px;">ğŸ‰</div>
          <div style="font-weight: bold;">æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼</div>
          <div style="font-size: 0.9em; opacity: 0.8; margin-top: 10px;">
            Week 3 åŸºç¡€åŠŸèƒ½é›†æˆæµ‹è¯•å®Œæˆ<br>
            æ€§èƒ½æŒ‡æ ‡å…¨éƒ¨è¾¾æ ‡
          </div>
        </div>
      `;
    }

    // ä½¿å‡½æ•°å…¨å±€å¯ç”¨
    window.demoConfigLoad = demoConfigLoad;
    window.demoCategoryLoad = demoCategoryLoad;
    window.demoCacheHit = demoCacheHit;
    window.demoError = demoError;
    window.demoSuccess = demoSuccess;
  </script>
</body>
</html>
