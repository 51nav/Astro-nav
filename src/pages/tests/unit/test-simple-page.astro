---
// ç®€åŒ–çš„æµ‹è¯•é¡µé¢ - çº¯JavaScriptï¼Œæ— TypeScripté”™è¯¯
export const prerender = false;
---

<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®€åŒ–æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª ç®€åŒ–æµ‹è¯•é¡µé¢</h1>
        <p>æµ‹è¯•JavaScriptåŸºæœ¬åŠŸèƒ½å’Œæ‡’åŠ è½½</p>

        <!-- åŸºç¡€æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”§ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
            <button class="test-button" onclick="testBasic()">ğŸ¯ åŸºç¡€æµ‹è¯•</button>
            <div id="basicResult" class="result" style="display: none;"></div>
        </div>

        <!-- é…ç½®æ–‡ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“„ é…ç½®æ–‡ä»¶æµ‹è¯•</h2>
            <select id="configSelect">
                <option value="/config.json">ä¼˜åŒ–é…ç½® (config.json)</option>
                <option value="/config-traditional.json">ä¼ ç»Ÿé…ç½® (config-traditional.json)</option>
            </select>
            <br>
            <button class="test-button" onclick="testConfig()">ğŸ“‹ æµ‹è¯•é…ç½®</button>
            <div id="configResult" class="result" style="display: none;"></div>
        </div>

        <!-- åˆ†ç±»æ–‡ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“ åˆ†ç±»æ–‡ä»¶æµ‹è¯•</h2>
            <select id="categorySelect">
                <option value="0">åˆ†ç±» 0</option>
                <option value="1">åˆ†ç±» 1</option>
                <option value="2">åˆ†ç±» 2</option>
                <option value="3">åˆ†ç±» 3</option>
                <option value="4">åˆ†ç±» 4</option>
                <option value="5">åˆ†ç±» 5</option>
            </select>
            <br>
            <button class="test-button" onclick="testCategory()">ğŸ“‚ æµ‹è¯•åˆ†ç±»</button>
            <div id="categoryResult" class="result" style="display: none;"></div>
        </div>

        <!-- ç½‘ç»œç›‘æ§ -->
        <div class="test-section">
            <h2>ğŸŒ ç½‘ç»œè¯·æ±‚ç›‘æ§</h2>
            <button class="test-button" onclick="clearLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
            <div id="networkLog" class="result info" style="display: block;">
                <strong>ç½‘ç»œè¯·æ±‚æ—¥å¿—:</strong>
                <div id="logContent">æš‚æ— è¯·æ±‚</div>
            </div>
        </div>
    </div>

    <script>
        // ç½‘ç»œè¯·æ±‚æ—¥å¿—
        var requestLog = [];

        // ç›‘æ§fetchè¯·æ±‚
        var originalFetch = window.fetch;
        window.fetch = function() {
            var args = Array.prototype.slice.call(arguments);
            var url = args[0];
            var startTime = Date.now();

            logRequest(url, 'pending', startTime);

            return originalFetch.apply(this, args)
                .then(function(response) {
                    var endTime = Date.now();
                    var duration = endTime - startTime;
                    logRequest(url, response.ok ? 'success' : 'error', startTime, duration, response.status);
                    return response;
                })
                .catch(function(error) {
                    var endTime = Date.now();
                    var duration = endTime - startTime;
                    logRequest(url, 'error', startTime, duration, 0, error.message);
                    throw error;
                });
        };

        // è®°å½•è¯·æ±‚
        function logRequest(url, status, startTime, duration, statusCode, error) {
            const logEntry = {
                url: url,
                status: status,
                startTime: startTime,
                duration: duration || 0,
                statusCode: statusCode || 0,
                error: error || ''
            };
            
            requestLog.push(logEntry);
            updateLogDisplay();
        }

        // æ›´æ–°æ—¥å¿—æ˜¾ç¤º
        function updateLogDisplay() {
            const logDiv = document.getElementById('logContent');
            if (!logDiv) return;

            if (requestLog.length === 0) {
                logDiv.textContent = 'æš‚æ— è¯·æ±‚';
                return;
            }

            const logText = requestLog.map(entry => {
                const status = entry.status === 'success' ? 'âœ…' : 
                             entry.status === 'error' ? 'âŒ' : 'â³';
                const time = entry.duration > 0 ? `${entry.duration}ms` : 'pending';
                const code = entry.statusCode > 0 ? `[${entry.statusCode}]` : '';
                const error = entry.error ? ` (${entry.error})` : '';
                
                return `${status} ${entry.url} - ${time} ${code}${error}`;
            }).join('\n');

            logDiv.textContent = logText;
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            requestLog = [];
            updateLogDisplay();
            console.log('ğŸ—‘ï¸ ç½‘ç»œæ—¥å¿—å·²æ¸…ç©º');
        }

        // åŸºç¡€æµ‹è¯•
        function testBasic() {
            console.log('ğŸ§ª å¼€å§‹åŸºç¡€æµ‹è¯•...');
            const resultDiv = document.getElementById('basicResult');
            
            try {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result success';
                
                let result = 'ğŸ‰ åŸºç¡€æµ‹è¯•æˆåŠŸï¼\n\n';
                result += 'æµ‹è¯•é¡¹ç›®:\n';
                result += 'âœ… JavaScriptæ‰§è¡Œæ­£å¸¸\n';
                result += 'âœ… DOMæ“ä½œæ­£å¸¸\n';
                result += 'âœ… äº‹ä»¶ç»‘å®šæ­£å¸¸\n';
                result += 'âœ… æ§åˆ¶å°è¾“å‡ºæ­£å¸¸\n';
                result += 'âœ… ç½‘ç»œç›‘æ§æ­£å¸¸\n\n';
                result += `å½“å‰æ—¶é—´: ${new Date().toLocaleString()}\n`;
                result += `ç”¨æˆ·ä»£ç†: ${navigator.userAgent.substring(0, 50)}...`;
                
                resultDiv.textContent = result;
                console.log('âœ… åŸºç¡€æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ åŸºç¡€æµ‹è¯•å¤±è´¥:\n${error.message}`;
                console.error('âŒ åŸºç¡€æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // æµ‹è¯•é…ç½®æ–‡ä»¶
        async function testConfig() {
            console.log('ğŸ“„ å¼€å§‹é…ç½®æ–‡ä»¶æµ‹è¯•...');
            const resultDiv = document.getElementById('configResult');
            const select = document.getElementById('configSelect');
            
            try {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result info';
                resultDiv.textContent = 'ğŸ”„ æ­£åœ¨åŠ è½½é…ç½®æ–‡ä»¶...';
                
                const configPath = select.value;
                console.log(`ğŸ“‹ åŠ è½½é…ç½®: ${configPath}`);
                
                const response = await fetch(configPath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const config = await response.json();
                
                let result = 'ğŸ“„ é…ç½®æ–‡ä»¶æµ‹è¯•æˆåŠŸï¼\n\n';
                result += `é…ç½®æ–‡ä»¶: ${configPath}\n`;
                result += `æ–‡ä»¶å¤§å°: ${JSON.stringify(config).length} å­—ç¬¦\n`;
                result += `ç½‘ç«™æ ‡é¢˜: ${config.site?.title || 'æœªè®¾ç½®'}\n`;
                result += `èœå•æ•°é‡: ${config.menuItems?.length || 0}\n`;
                
                // æ£€æŸ¥ä¼˜åŒ–æ ¼å¼ç‰¹å¾
                const hasOptimization = config.optimization && config.optimization.enabled;
                const hasCategoryIndex = config.menuItems && config.menuItems.some(item => 
                    typeof item.categoryIndex === 'number'
                );
                
                result += `\næ ¼å¼æ£€æµ‹:\n`;
                result += `ä¼˜åŒ–å­—æ®µ: ${hasOptimization ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
                result += `åˆ†ç±»ç´¢å¼•: ${hasCategoryIndex ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨'}\n`;
                result += `æ ¼å¼ç±»å‹: ${hasOptimization && hasCategoryIndex ? 'ä¼˜åŒ–æ ¼å¼' : 'ä¼ ç»Ÿæ ¼å¼'}\n`;
                
                if (config.optimization) {
                    result += `\nä¼˜åŒ–ä¿¡æ¯:\n`;
                    result += `æ€»åˆ†ç±»æ•°: ${config.optimization.totalCategories || 'N/A'}\n`;
                    result += `æ€»ç½‘ç«™æ•°: ${config.optimization.totalSites || 'N/A'}\n`;
                    result += `å‹ç¼©æ¯”ä¾‹: ${config.optimization.compressionRatio || 'N/A'}%\n`;
                }
                
                resultDiv.className = 'result success';
                resultDiv.textContent = result;
                console.log('âœ… é…ç½®æ–‡ä»¶æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ é…ç½®æ–‡ä»¶æµ‹è¯•å¤±è´¥:\n${error.message}`;
                console.error('âŒ é…ç½®æ–‡ä»¶æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // æµ‹è¯•åˆ†ç±»æ–‡ä»¶
        async function testCategory() {
            console.log('ğŸ“ å¼€å§‹åˆ†ç±»æ–‡ä»¶æµ‹è¯•...');
            const resultDiv = document.getElementById('categoryResult');
            const select = document.getElementById('categorySelect');
            
            try {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result info';
                resultDiv.textContent = 'ğŸ”„ æ­£åœ¨åŠ è½½åˆ†ç±»æ–‡ä»¶...';
                
                const categoryId = select.value;
                const categoryPath = `/categories/${categoryId}.json`;
                console.log(`ğŸ“‚ åŠ è½½åˆ†ç±»: ${categoryPath}`);
                
                const response = await fetch(categoryPath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const categoryData = await response.json();
                
                let result = 'ğŸ“ åˆ†ç±»æ–‡ä»¶æµ‹è¯•æˆåŠŸï¼\n\n';
                result += `åˆ†ç±»æ–‡ä»¶: ${categoryPath}\n`;
                result += `åˆ†ç±»ID: ${categoryData.categoryId || 'N/A'}\n`;
                result += `åˆ†ç±»åç§°: ${categoryData.categoryName || 'æœªçŸ¥'}\n`;
                result += `ç½‘ç«™æ•°é‡: ${categoryData.sites?.length || 0}\n`;
                result += `æ–‡ä»¶å¤§å°: ${JSON.stringify(categoryData).length} å­—ç¬¦\n`;
                
                if (categoryData.sites && categoryData.sites.length > 0) {
                    result += `\nç½‘ç«™ç¤ºä¾‹:\n`;
                    categoryData.sites.slice(0, 3).forEach((site, index) => {
                        result += `${index + 1}. ${site.title || 'æœªçŸ¥'}\n`;
                        result += `   ${site.url || 'æ— é“¾æ¥'}\n`;
                    });
                    
                    if (categoryData.sites.length > 3) {
                        result += `... è¿˜æœ‰ ${categoryData.sites.length - 3} ä¸ªç½‘ç«™\n`;
                    }
                }
                
                resultDiv.className = 'result success';
                resultDiv.textContent = result;
                console.log('âœ… åˆ†ç±»æ–‡ä»¶æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ åˆ†ç±»æ–‡ä»¶æµ‹è¯•å¤±è´¥:\n${error.message}`;
                console.error('âŒ åˆ†ç±»æ–‡ä»¶æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ ç®€åŒ–æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ’¡ æç¤º: æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—');
        });
    </script>
</body>
</html>
