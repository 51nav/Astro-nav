---
// ä¼˜åŒ–é…ç½®æµ‹è¯•é¡µé¢
export const prerender = false;
---

<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¼˜åŒ–é…ç½®æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .category-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            background: white;
        }
        .category-item {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .category-item:last-child {
            border-bottom: none;
        }
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ ä¼˜åŒ–é…ç½®æµ‹è¯•</h1>
            <p>æµ‹è¯•CSVæ„å»ºç”Ÿæˆçš„ä¼˜åŒ–é…ç½®æ˜¯å¦æ­£ç¡®å·¥ä½œ</p>
        </div>

        <!-- é…ç½®æ–‡ä»¶é€‰æ‹© -->
        <div class="test-section">
            <h2>âš™ï¸ é…ç½®é€‰æ‹©</h2>
            <p>é€‰æ‹©è¦æµ‹è¯•çš„é…ç½®æ–‡ä»¶</p>
            <div style="margin: 15px 0;">
                <label for="configPath" style="display: block; margin-bottom: 8px; font-weight: bold;">é…ç½®æ–‡ä»¶:</label>
                <select id="configPath" style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; width: 400px;">
                    <option value="/config.json">ä¼˜åŒ–æ ¼å¼ - CSVæ„å»ºç”Ÿæˆ (config.json)</option>
                    <option value="/config-optimized.json">ä¼˜åŒ–æ ¼å¼ - å‰¯æœ¬ (config-optimized.json)</option>
                    <option value="/config-traditional.json">ä¼ ç»Ÿæ ¼å¼ - åŸå§‹æ•°æ® (config-traditional.json)</option>
                </select>
                <div style="margin-top: 8px; font-size: 12px; color: #666;">
                    ğŸ’¡ æç¤º: é€‰æ‹©ä¸åŒçš„é…ç½®æ–‡ä»¶æ¥æµ‹è¯•ä¸åŒæ ¼å¼çš„æ£€æµ‹æ•ˆæœ
                </div>
            </div>
        </div>

        <!-- åŸºç¡€é…ç½®æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“„ åŸºç¡€é…ç½®æµ‹è¯•</h2>
            <p>æµ‹è¯•ä¸»é…ç½®æ–‡ä»¶çš„åŠ è½½å’Œæ ¼å¼æ£€æµ‹</p>
            <button class="test-button" onclick="testBaseConfig()">ğŸ” æµ‹è¯•åŸºç¡€é…ç½®</button>
            <div id="baseConfigResult" class="result" style="display: none;"></div>
        </div>

        <!-- ConfigManageræµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”§ ConfigManageræµ‹è¯•</h2>
            <p>æµ‹è¯•ConfigManagerçš„æ ¼å¼æ£€æµ‹å’ŒåŠ è½½åŠŸèƒ½</p>
            <button class="test-button" onclick="testConfigManager()">âš¡ æµ‹è¯•ConfigManager</button>
            <div id="configManagerResult" class="result" style="display: none;"></div>
        </div>

        <!-- åˆ†ç±»æ–‡ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“ åˆ†ç±»æ–‡ä»¶æµ‹è¯•</h2>
            <p>æµ‹è¯•åˆ†ç±»æ–‡ä»¶çš„åŠ è½½å’Œæ•°æ®å®Œæ•´æ€§</p>
            <button class="test-button" onclick="testCategoryFiles()">ğŸ“‚ æµ‹è¯•åˆ†ç±»æ–‡ä»¶</button>
            <div id="categoryResult" class="result" style="display: none;"></div>
            <div id="categoryStats" class="stats-grid" style="display: none;"></div>
            <div id="categoryList" class="category-list" style="display: none;"></div>
        </div>

        <!-- æ‡’åŠ è½½æµ‹è¯• -->
        <div class="test-section">
            <h2>âš¡ æ‡’åŠ è½½æµ‹è¯•</h2>
            <p>æµ‹è¯•æŒ‰éœ€åŠ è½½åˆ†ç±»æ•°æ®çš„åŠŸèƒ½ï¼Œæ˜¾ç¤ºå…·ä½“è°ƒç”¨çš„æ–‡ä»¶</p>
            <button class="test-button" onclick="testLazyLoading()">ğŸ”„ æµ‹è¯•æ‡’åŠ è½½</button>
            <button class="test-button" onclick="testSpecificCategory()">ğŸ“ æµ‹è¯•ç‰¹å®šåˆ†ç±»</button>
            <button class="test-button" onclick="testSimple()" style="background: #28a745;">ğŸ§ª ç®€å•æµ‹è¯•</button>
            <div style="margin: 10px 0;">
                <label for="categoryId">é€‰æ‹©åˆ†ç±»ID:</label>
                <select id="categoryId" style="padding: 4px 8px; margin-left: 8px;">
                    <option value="0">åˆ†ç±» 0</option>
                    <option value="1">åˆ†ç±» 1</option>
                    <option value="2">åˆ†ç±» 2</option>
                    <option value="3">åˆ†ç±» 3</option>
                    <option value="4">åˆ†ç±» 4</option>
                    <option value="5">åˆ†ç±» 5</option>
                </select>
            </div>
            <div id="lazyLoadResult" class="result" style="display: none;"></div>
            <div id="networkLog" style="display: none; margin-top: 15px; padding: 15px; background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px;">
                <h4>ğŸŒ ç½‘ç»œè¯·æ±‚æ—¥å¿—</h4>
                <div id="networkLogContent" style="font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto;"></div>
            </div>
        </div>

        <!-- æ€§èƒ½æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“Š æ€§èƒ½æµ‹è¯•</h2>
            <p>æµ‹è¯•é…ç½®åŠ è½½æ€§èƒ½å’Œæ–‡ä»¶å¤§å°</p>
            <button class="test-button" onclick="testPerformance()">â±ï¸ æµ‹è¯•æ€§èƒ½</button>
            <div id="performanceResult" class="result" style="display: none;"></div>
        </div>
    </div>

    <script>
        // ç½‘ç»œè¯·æ±‚æ—¥å¿—
        let networkRequests = [];

        // ç›‘æ§fetchè¯·æ±‚
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            const url = args[0];
            const startTime = performance.now();

            networkRequests.push({
                url: url,
                startTime: startTime,
                status: 'pending'
            });

            return originalFetch.apply(this, args).then(response => {
                const endTime = performance.now();
                const requestIndex = networkRequests.findIndex(req =>
                    req.url === url && req.status === 'pending'
                );

                if (requestIndex !== -1) {
                    networkRequests[requestIndex] = {
                        ...networkRequests[requestIndex],
                        status: response.ok ? 'success' : 'error',
                        statusCode: response.status,
                        loadTime: endTime - startTime,
                        size: response.headers.get('content-length') || 'unknown'
                    };
                }

                updateNetworkLog();
                return response;
            }).catch(error => {
                const endTime = performance.now();
                const requestIndex = networkRequests.findIndex(req =>
                    req.url === url && req.status === 'pending'
                );

                if (requestIndex !== -1) {
                    networkRequests[requestIndex] = {
                        ...networkRequests[requestIndex],
                        status: 'error',
                        error: error.message,
                        loadTime: endTime - startTime
                    };
                }

                updateNetworkLog();
                throw error;
            });
        };

        // æ›´æ–°ç½‘ç»œæ—¥å¿—æ˜¾ç¤º
        function updateNetworkLog() {
            const logDiv = document.getElementById('networkLogContent');
            if (!logDiv) return;

            const logContent = networkRequests.map(req => {
                const status = req.status === 'success' ? 'âœ…' :
                             req.status === 'error' ? 'âŒ' : 'â³';
                const time = req.loadTime ? req.loadTime.toFixed(2) + 'ms' : 'pending';
                const size = req.size !== 'unknown' ? Math.round(req.size/1024) + 'KB' : '';

                return status + ' ' + req.url + ' - ' + time + ' ' + size;
            }).join('\n');

            logDiv.textContent = logContent;
        }

        // æ¸…ç©ºç½‘ç»œæ—¥å¿—
        function clearNetworkLog() {
            networkRequests = [];
            updateNetworkLog();
        }

        // è·å–é€‰æ‹©çš„é…ç½®è·¯å¾„
        function getSelectedConfigPath() {
            const select = document.getElementById('configPath');
            return select ? select.value : '/config.json';
        }

        // ç®€å•æµ‹è¯•å‡½æ•°
        function testSimple() {
            try {
                console.log('ğŸ§ª å¼€å§‹ç®€å•æµ‹è¯•...');
                const resultDiv = document.getElementById('lazyLoadResult');
                if (resultDiv) {
                    resultDiv.style.display = 'block';
                    resultDiv.className = 'result success';
                    resultDiv.textContent = 'ğŸ‰ ç®€å•æµ‹è¯•æˆåŠŸï¼JavaScriptæ­£å¸¸å·¥ä½œã€‚\n\næµ‹è¯•ç»“æœ:\n- âœ… å‡½æ•°è°ƒç”¨æˆåŠŸ\n- âœ… DOMå…ƒç´ è®¿é—®æ­£å¸¸\n- âœ… æ ·å¼è®¾ç½®æ­£å¸¸';
                    console.log('âœ… ç®€å•æµ‹è¯•æˆåŠŸ');
                } else {
                    console.error('âŒ æ‰¾ä¸åˆ°ç»“æœæ˜¾ç¤ºåŒºåŸŸ');
                    alert('âŒ æ‰¾ä¸åˆ°ç»“æœæ˜¾ç¤ºåŒºåŸŸ');
                }
            } catch (error) {
                console.error('âŒ ç®€å•æµ‹è¯•å¤±è´¥:', error);
                alert('âŒ ç®€å•æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        // æµ‹è¯•ç‰¹å®šåˆ†ç±»
        async function testSpecificCategory() {
            const resultDiv = document.getElementById('lazyLoadResult');
            const networkLogDiv = document.getElementById('networkLog');
            const categorySelect = document.getElementById('categoryId');

            if (!resultDiv || !categorySelect) return;

            const categoryId = categorySelect.value;

            resultDiv.style.display = 'block';
            networkLogDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = `ğŸ”„ æ­£åœ¨æµ‹è¯•åˆ†ç±» ${categoryId}...`;

            // æ¸…ç©ºç½‘ç»œæ—¥å¿—
            clearNetworkLog();

            try {
                const startTime = performance.now();

                // 1. å…ˆåŠ è½½åŸºç¡€é…ç½®
                const configPath = getSelectedConfigPath();
                console.log(`ğŸ“„ åŠ è½½åŸºç¡€é…ç½®: ${configPath}`);
                const configResponse = await fetch(configPath);
                const config = await configResponse.json();
                const configLoadTime = performance.now() - startTime;

                // 2. åŠ è½½ç‰¹å®šåˆ†ç±»
                const categoryStartTime = performance.now();
                const categoryUrl = `/categories/${categoryId}.json`;
                console.log(`ğŸ“ åŠ è½½åˆ†ç±»æ–‡ä»¶: ${categoryUrl}`);
                const categoryResponse = await fetch(categoryUrl);

                if (!categoryResponse.ok) {
                    throw new Error(`åˆ†ç±»æ–‡ä»¶åŠ è½½å¤±è´¥: ${categoryResponse.status} ${categoryResponse.statusText}`);
                }

                const categoryData = await categoryResponse.json();
                const categoryLoadTime = performance.now() - categoryStartTime;
                const totalTime = performance.now() - startTime;

                // 3. æ˜¾ç¤ºç»“æœ
                let result = `ğŸ“ åˆ†ç±» ${categoryId} æµ‹è¯•å®Œæˆ!\n\n`;
                result += `ğŸ“Š åŠ è½½ç»“æœ:\n`;
                result += `  - åŸºç¡€é…ç½®: ${configPath}\n`;
                result += `  - åˆ†ç±»æ–‡ä»¶: ${categoryUrl}\n`;
                result += `  - åˆ†ç±»åç§°: ${categoryData.categoryName || 'æœªçŸ¥'}\n`;
                result += `  - ç½‘ç«™æ•°é‡: ${categoryData.sites?.length || 0}\n\n`;

                result += `â±ï¸ æ€§èƒ½æ•°æ®:\n`;
                result += `  - åŸºç¡€é…ç½®åŠ è½½: ${configLoadTime.toFixed(2)}ms\n`;
                result += `  - åˆ†ç±»æ•°æ®åŠ è½½: ${categoryLoadTime.toFixed(2)}ms\n`;
                result += `  - æ€»åŠ è½½æ—¶é—´: ${totalTime.toFixed(2)}ms\n\n`;

                result += `ğŸ” ç½‘ç»œè¯·æ±‚:\n`;
                result += `  - è¯·æ±‚æ•°é‡: ${networkRequests.length}\n`;
                result += `  - æˆåŠŸè¯·æ±‚: ${networkRequests.filter(r => r.status === 'success').length}\n`;
                result += `  - å¤±è´¥è¯·æ±‚: ${networkRequests.filter(r => r.status === 'error').length}\n\n`;

                if (categoryData.sites && categoryData.sites.length > 0) {
                    result += `ğŸ“‹ ç½‘ç«™ç¤ºä¾‹:\n`;
                    categoryData.sites.slice(0, 3).forEach((site, index) => {
                        result += `  ${index + 1}. ${site.title || 'æœªçŸ¥'} - ${site.url || 'æ— é“¾æ¥'}\n`;
                    });
                    if (categoryData.sites.length > 3) {
                        result += `  ... è¿˜æœ‰ ${categoryData.sites.length - 3} ä¸ªç½‘ç«™\n`;
                    }
                }

                resultDiv.className = 'result success';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ åˆ†ç±» ${categoryId} æµ‹è¯•å¤±è´¥:\n${error.message}\n\nç½‘ç»œè¯·æ±‚: ${networkRequests.length} ä¸ª`;
            }
        }

        // æµ‹è¯•åŸºç¡€é…ç½®
        async function testBaseConfig() {
            const resultDiv = document.getElementById('baseConfigResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨åŠ è½½åŸºç¡€é…ç½®...';

            try {
                const configPath = getSelectedConfigPath();
                const response = await fetch(configPath);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const config = await response.json();
                
                // æ£€æŸ¥ä¼˜åŒ–æ ¼å¼ç‰¹å¾
                const isOptimized = config.optimization && config.optimization.enabled;
                const hasMenuItems = config.menuItems && Array.isArray(config.menuItems);
                const hasCategoryIndex = config.menuItems.some(item => 
                    typeof item.categoryIndex === 'number' || 
                    (item.submenu && item.submenu.some(sub => typeof sub.categoryIndex === 'number'))
                );

                let result = 'âœ… åŸºç¡€é…ç½®åŠ è½½æˆåŠŸï¼\n\n';
                result += `ğŸ“Š é…ç½®ä¿¡æ¯:\n`;
                result += `  - é…ç½®æ–‡ä»¶: ${configPath}\n`;
                result += `  - ç½‘ç«™æ ‡é¢˜: ${config.site?.title || 'æœªè®¾ç½®'}\n`;
                result += `  - ç½‘ç«™æè¿°: ${config.site?.description || 'æœªè®¾ç½®'}\n`;
                result += `  - èœå•é¡¹æ•°: ${config.menuItems?.length || 0}\n\n`;
                
                result += `ğŸ” æ ¼å¼æ£€æµ‹:\n`;
                result += `  - ä¼˜åŒ–æ ¼å¼: ${isOptimized ? 'âœ… æ˜¯' : 'âŒ å¦'}\n`;
                result += `  - èœå•ç»“æ„: ${hasMenuItems ? 'âœ… æ­£ç¡®' : 'âŒ é”™è¯¯'}\n`;
                result += `  - åˆ†ç±»ç´¢å¼•: ${hasCategoryIndex ? 'âœ… å­˜åœ¨' : 'âŒ ç¼ºå¤±'}\n\n`;

                if (config.optimization) {
                    result += `ğŸ“ˆ ä¼˜åŒ–ç»Ÿè®¡:\n`;
                    result += `  - ç‰ˆæœ¬: ${config.optimization.version}\n`;
                    result += `  - æ€»åˆ†ç±»æ•°: ${config.optimization.totalCategories}\n`;
                    result += `  - æ€»ç½‘ç«™æ•°: ${config.optimization.totalSites}\n`;
                    result += `  - å‹ç¼©æ¯”ä¾‹: ${config.optimization.compressionRatio}%\n`;
                    result += `  - ç”Ÿæˆæ—¶é—´: ${new Date(config.optimization.generatedAt).toLocaleString()}\n`;
                }

                resultDiv.className = 'result success';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ åŸºç¡€é…ç½®æµ‹è¯•å¤±è´¥:\n${error.message}`;
            }
        }

        // æµ‹è¯•ConfigManager
        async function testConfigManager() {
            const resultDiv = document.getElementById('configManagerResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•ConfigManager...';

            try {
                // ä½¿ç”¨çœŸæ­£çš„ConfigManageræ£€æµ‹é€»è¾‘
                const startTime = performance.now();

                const configPath = getSelectedConfigPath();
                const response = await fetch(configPath);
                const config = await response.json();

                const loadTime = performance.now() - startTime;

                // çœŸæ­£çš„ConfigManageræ£€æµ‹é€»è¾‘
                let confidence = 0;
                let isOptimized = false;
                let hasOptimizationField = false;
                let hasCategoryIndexes = false;
                let hasPreviewSites = false;
                let estimatedCategories = 0;
                let details = [];

                // 1. æ£€æŸ¥optimizationå­—æ®µ (æƒé‡: 40%)
                if (config.optimization && typeof config.optimization === 'object') {
                    hasOptimizationField = true;
                    details.push('âœ… æ£€æµ‹åˆ°optimizationå­—æ®µ');
                    if (config.optimization.enabled === true) {
                        confidence += 0.4;
                        isOptimized = true;
                        details.push('âœ… optimization.enabled = true');
                    }
                } else {
                    details.push('âŒ æœªæ£€æµ‹åˆ°optimizationå­—æ®µ');
                }

                // 2. æ£€æŸ¥categoryIndexå­—æ®µ (æƒé‡: 40%)
                if (config.menuItems && Array.isArray(config.menuItems)) {
                    details.push('âœ… èœå•ç»“æ„æ­£ç¡®');

                    const itemsWithCategoryIndex = config.menuItems.filter(item =>
                        typeof item.categoryIndex === 'number' && item.categoryIndex >= 0
                    );

                    if (itemsWithCategoryIndex.length > 0) {
                        hasCategoryIndexes = true;
                        confidence += 0.4;
                        isOptimized = true;
                        details.push(`âœ… æ£€æµ‹åˆ°${itemsWithCategoryIndex.length}ä¸ªcategoryIndexå­—æ®µ`);

                        // è®¡ç®—åˆ†ç±»æ•°é‡ (åŒ…æ‹¬submenu)
                        const allIndexes = [];
                        config.menuItems.forEach(item => {
                            if (typeof item.categoryIndex === 'number' && item.categoryIndex >= 0) {
                                allIndexes.push(item.categoryIndex);
                            }
                            if (item.submenu && Array.isArray(item.submenu)) {
                                item.submenu.forEach(sub => {
                                    if (typeof sub.categoryIndex === 'number' && sub.categoryIndex >= 0) {
                                        allIndexes.push(sub.categoryIndex);
                                    }
                                });
                            }
                        });
                        estimatedCategories = allIndexes.length > 0 ? Math.max(...allIndexes) + 1 : 0;
                        details.push(`ğŸ“Š ä¼°ç®—åˆ†ç±»æ•°: ${estimatedCategories}`);
                    } else {
                        details.push('âŒ æœªæ£€æµ‹åˆ°categoryIndexå­—æ®µ');
                    }
                } else {
                    details.push('âŒ èœå•ç»“æ„é”™è¯¯');
                }

                // 3. æ£€æŸ¥previewSiteså­—æ®µ (æƒé‡: 20%)
                if (config.menuItems && config.menuItems.some(item =>
                    Array.isArray(item.previewSites) ||
                    (item.submenu && item.submenu.some(sub => Array.isArray(sub.previewSites)))
                )) {
                    hasPreviewSites = true;
                    confidence += 0.2;
                    isOptimized = true;
                    details.push('âœ… æ£€æµ‹åˆ°previewSiteså­—æ®µ');
                } else {
                    details.push('âŒ æœªæ£€æµ‹åˆ°previewSiteså­—æ®µ');
                }

                // 4. æ£€æŸ¥ä¼ ç»Ÿæ ¼å¼ç‰¹å¾
                if (!isOptimized && config.menuItems && config.menuItems.some(item =>
                    Array.isArray(item.sites) ||
                    (item.submenu && item.submenu.some(sub => Array.isArray(sub.sites)))
                )) {
                    confidence = 0.95; // ä¼ ç»Ÿé…ç½®çš„é«˜ç½®ä¿¡åº¦
                    details.push('âœ… æ£€æµ‹åˆ°ä¼ ç»Ÿæ ¼å¼siteså­—æ®µ');
                }

                // 5. æ£€æŸ¥categoryMapå­—æ®µ (ä¼ ç»Ÿæ ¼å¼ç‰¹å¾)
                if (config.categoryMap && typeof config.categoryMap === 'object') {
                    if (!isOptimized) {
                        confidence += 0.05; // å¢å¼ºä¼ ç»Ÿæ ¼å¼ç½®ä¿¡åº¦
                        details.push('âœ… æ£€æµ‹åˆ°categoryMapå­—æ®µ (ä¼ ç»Ÿæ ¼å¼)');
                    }
                }

                const confidencePercent = Math.round(confidence * 100);
                const formatType = isOptimized ? 'optimized' : 'traditional';

                let result = 'ğŸ”§ ConfigManageræµ‹è¯•ç»“æœ (çœŸå®æ£€æµ‹é€»è¾‘):\n\n';
                result += `ğŸ“Š æ£€æµ‹ç»“æœ:\n`;
                result += `  - é…ç½®æ–‡ä»¶: ${configPath}\n`;
                result += `  - æ ¼å¼ç±»å‹: ${formatType === 'optimized' ? 'ä¼˜åŒ–æ ¼å¼' : 'ä¼ ç»Ÿæ ¼å¼'}\n`;
                result += `  - ç½®ä¿¡åº¦: ${confidencePercent}%\n`;
                result += `  - åŠ è½½æ—¶é—´: ${loadTime.toFixed(2)}ms\n`;
                result += `  - æ˜¯å¦ä¼˜åŒ–: ${isOptimized ? 'æ˜¯' : 'å¦'}\n\n`;

                result += `ğŸ” æ£€æµ‹è¯¦æƒ…:\n`;
                details.forEach(detail => {
                    result += `  ${detail}\n`;
                });

                if (isOptimized && config.optimization) {
                    result += `\nğŸ“ˆ ä¼˜åŒ–ä¿¡æ¯:\n`;
                    result += `  - ç‰ˆæœ¬: ${config.optimization.version || 'N/A'}\n`;
                    result += `  - æ€»åˆ†ç±»æ•°: ${config.optimization.totalCategories || 'N/A'}\n`;
                    result += `  - æ€»ç½‘ç«™æ•°: ${config.optimization.totalSites || 'N/A'}\n`;
                    result += `  - å‹ç¼©æ¯”ä¾‹: ${config.optimization.compressionRatio || 'N/A'}%\n`;
                }

                resultDiv.className = confidencePercent >= 90 ? 'result success' : 'result error';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ ConfigManageræµ‹è¯•å¤±è´¥:\n${error.message}`;
            }
        }

        // æµ‹è¯•åˆ†ç±»æ–‡ä»¶
        async function testCategoryFiles() {
            const resultDiv = document.getElementById('categoryResult');
            const statsDiv = document.getElementById('categoryStats');
            const listDiv = document.getElementById('categoryList');
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•åˆ†ç±»æ–‡ä»¶...';

            try {
                // å…ˆè·å–åŸºç¡€é…ç½®
                const configPath = getSelectedConfigPath();
                const configResponse = await fetch(configPath);
                const config = await configResponse.json();
                
                const totalCategories = config.optimization?.totalCategories || 0;
                let successCount = 0;
                let totalSites = 0;
                let categoryDetails = [];

                // æµ‹è¯•æ¯ä¸ªåˆ†ç±»æ–‡ä»¶
                for (let i = 0; i < totalCategories; i++) {
                    try {
                        const categoryResponse = await fetch(`/categories/${i}.json`);
                        if (categoryResponse.ok) {
                            const categoryData = await categoryResponse.json();
                            successCount++;
                            totalSites += categoryData.sites?.length || 0;
                            
                            categoryDetails.push({
                                id: i,
                                name: categoryData.categoryName,
                                siteCount: categoryData.sites?.length || 0,
                                status: 'âœ…'
                            });
                        } else {
                            categoryDetails.push({
                                id: i,
                                name: `åˆ†ç±»${i}`,
                                siteCount: 0,
                                status: 'âŒ'
                            });
                        }
                    } catch (error) {
                        categoryDetails.push({
                            id: i,
                            name: `åˆ†ç±»${i}`,
                            siteCount: 0,
                            status: 'âŒ'
                        });
                    }
                }

                // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
                statsDiv.style.display = 'grid';
                statsDiv.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-value">${totalCategories}</div>
                        <div class="stat-label">æ€»åˆ†ç±»æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${successCount}</div>
                        <div class="stat-label">æˆåŠŸåŠ è½½</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalSites}</div>
                        <div class="stat-label">æ€»ç½‘ç«™æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${Math.round(successCount/totalCategories*100)}%</div>
                        <div class="stat-label">æˆåŠŸç‡</div>
                    </div>
                `;

                // æ˜¾ç¤ºåˆ†ç±»åˆ—è¡¨
                listDiv.style.display = 'block';
                listDiv.innerHTML = categoryDetails.map(cat => `
                    <div class="category-item">
                        <span>${cat.status} ${cat.name}</span>
                        <span>${cat.siteCount} ä¸ªç½‘ç«™</span>
                    </div>
                `).join('');

                let result = `ğŸ“ åˆ†ç±»æ–‡ä»¶æµ‹è¯•å®Œæˆ!\n\n`;
                result += `ğŸ“Š æµ‹è¯•ç»“æœ:\n`;
                result += `  - æ€»åˆ†ç±»æ•°: ${totalCategories}\n`;
                result += `  - æˆåŠŸåŠ è½½: ${successCount}\n`;
                result += `  - å¤±è´¥æ•°é‡: ${totalCategories - successCount}\n`;
                result += `  - æˆåŠŸç‡: ${Math.round(successCount/totalCategories*100)}%\n`;
                result += `  - æ€»ç½‘ç«™æ•°: ${totalSites}\n`;

                resultDiv.className = successCount === totalCategories ? 'result success' : 'result error';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ åˆ†ç±»æ–‡ä»¶æµ‹è¯•å¤±è´¥:\n${error.message}`;
            }
        }

        // æµ‹è¯•æ‡’åŠ è½½
        async function testLazyLoading() {
            const resultDiv = document.getElementById('lazyLoadResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•æ‡’åŠ è½½...';

            try {
                const startTime = performance.now();

                // æ¨¡æ‹Ÿæ‡’åŠ è½½åœºæ™¯ï¼šå…ˆåŠ è½½åŸºç¡€é…ç½®ï¼Œå†æŒ‰éœ€åŠ è½½åˆ†ç±»
                const configPath = getSelectedConfigPath();
                const configResponse = await fetch(configPath);
                const config = await configResponse.json();
                const configLoadTime = performance.now() - startTime;

                // éšæœºé€‰æ‹©å‡ ä¸ªåˆ†ç±»è¿›è¡Œæ‡’åŠ è½½æµ‹è¯•
                const testCategories = [0, 1, 2]; // æµ‹è¯•å‰3ä¸ªåˆ†ç±»
                let lazyLoadResults = [];

                for (const categoryId of testCategories) {
                    const categoryStartTime = performance.now();
                    try {
                        const categoryResponse = await fetch(`/categories/${categoryId}.json`);
                        const categoryData = await categoryResponse.json();
                        const categoryLoadTime = performance.now() - categoryStartTime;
                        
                        lazyLoadResults.push({
                            id: categoryId,
                            name: categoryData.categoryName,
                            loadTime: categoryLoadTime,
                            siteCount: categoryData.sites.length,
                            success: true
                        });
                    } catch (error) {
                        lazyLoadResults.push({
                            id: categoryId,
                            name: `åˆ†ç±»${categoryId}`,
                            loadTime: 0,
                            siteCount: 0,
                            success: false
                        });
                    }
                }

                const totalTime = performance.now() - startTime;

                let result = `âš¡ æ‡’åŠ è½½æµ‹è¯•å®Œæˆ!\n\n`;
                result += `ğŸ“Š æ€§èƒ½ç»“æœ:\n`;
                result += `  - åŸºç¡€é…ç½®åŠ è½½: ${configLoadTime.toFixed(2)}ms\n`;
                result += `  - æ€»æµ‹è¯•æ—¶é—´: ${totalTime.toFixed(2)}ms\n\n`;
                
                result += `ğŸ“ åˆ†ç±»åŠ è½½æµ‹è¯•:\n`;
                lazyLoadResults.forEach(cat => {
                    const status = cat.success ? 'âœ…' : 'âŒ';
                    result += `  ${status} ${cat.name}: ${cat.loadTime.toFixed(2)}ms (${cat.siteCount}ä¸ªç½‘ç«™)\n`;
                });

                const successCount = lazyLoadResults.filter(cat => cat.success).length;
                result += `\nğŸ¯ æ‡’åŠ è½½ä¼˜åŠ¿:\n`;
                result += `  - é¦–æ¬¡åŠ è½½ä»…éœ€åŸºç¡€é…ç½® (${configLoadTime.toFixed(2)}ms)\n`;
                result += `  - æŒ‰éœ€åŠ è½½åˆ†ç±»æ•°æ®ï¼Œå‡å°‘åˆå§‹åŠ è½½æ—¶é—´\n`;
                result += `  - æµ‹è¯•æˆåŠŸç‡: ${Math.round(successCount/testCategories.length*100)}%\n`;

                resultDiv.className = successCount === testCategories.length ? 'result success' : 'result error';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ‡’åŠ è½½æµ‹è¯•å¤±è´¥:\n${error.message}`;
            }
        }

        // æµ‹è¯•æ€§èƒ½
        async function testPerformance() {
            const resultDiv = document.getElementById('performanceResult');
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•æ€§èƒ½...';

            try {
                const startTime = performance.now();

                // æµ‹è¯•åŸºç¡€é…ç½®æ–‡ä»¶å¤§å°å’ŒåŠ è½½æ—¶é—´
                const configPath = getSelectedConfigPath();
                const configResponse = await fetch(configPath);
                const configText = await configResponse.text();
                const config = JSON.parse(configText);
                const configSize = new Blob([configText]).size;
                const configLoadTime = performance.now() - startTime;

                // æµ‹è¯•åˆ†ç±»æ–‡ä»¶å¤§å°
                let totalCategorySize = 0;
                let categoryLoadTimes = [];
                const testCategoryCount = Math.min(5, config.optimization?.totalCategories || 0);

                for (let i = 0; i < testCategoryCount; i++) {
                    const categoryStartTime = performance.now();
                    try {
                        const categoryResponse = await fetch(`/categories/${i}.json`);
                        const categoryText = await categoryResponse.text();
                        const categorySize = new Blob([categoryText]).size;
                        const categoryLoadTime = performance.now() - categoryStartTime;
                        
                        totalCategorySize += categorySize;
                        categoryLoadTimes.push(categoryLoadTime);
                    } catch (error) {
                        // å¿½ç•¥åŠ è½½å¤±è´¥çš„åˆ†ç±»
                    }
                }

                const avgCategoryLoadTime = categoryLoadTimes.length > 0 
                    ? categoryLoadTimes.reduce((a, b) => a + b, 0) / categoryLoadTimes.length 
                    : 0;

                const totalTime = performance.now() - startTime;

                let result = `ğŸ“Š æ€§èƒ½æµ‹è¯•ç»“æœ:\n\n`;
                result += `ğŸ“„ åŸºç¡€é…ç½®:\n`;
                result += `  - æ–‡ä»¶å¤§å°: ${(configSize / 1024).toFixed(2)} KB\n`;
                result += `  - åŠ è½½æ—¶é—´: ${configLoadTime.toFixed(2)} ms\n\n`;
                
                result += `ğŸ“ åˆ†ç±»æ–‡ä»¶ (æµ‹è¯•${testCategoryCount}ä¸ª):\n`;
                result += `  - å¹³å‡å¤§å°: ${(totalCategorySize / testCategoryCount / 1024).toFixed(2)} KB\n`;
                result += `  - å¹³å‡åŠ è½½æ—¶é—´: ${avgCategoryLoadTime.toFixed(2)} ms\n\n`;
                
                result += `ğŸš€ æ€§èƒ½ä¼˜åŠ¿:\n`;
                result += `  - é¦–æ¬¡åŠ è½½ä»…éœ€åŸºç¡€é…ç½® (${(configSize / 1024).toFixed(2)} KB)\n`;
                result += `  - åˆ†ç±»æ•°æ®æŒ‰éœ€åŠ è½½ï¼Œå‡å°‘å¸¦å®½ä½¿ç”¨\n`;
                result += `  - æ€»æµ‹è¯•æ—¶é—´: ${totalTime.toFixed(2)} ms\n`;

                if (config.optimization) {
                    result += `\nğŸ“ˆ ä¼˜åŒ–ç»Ÿè®¡ (æ¥è‡ªé…ç½®):\n`;
                    result += `  - åŸå§‹å¤§å°: ${config.optimization.originalSizeKB} KB\n`;
                    result += `  - ä¼˜åŒ–åå¤§å°: ${config.optimization.optimizedSizeKB} KB\n`;
                    result += `  - å‹ç¼©æ¯”ä¾‹: ${config.optimization.compressionRatio}%\n`;
                }

                resultDiv.className = 'result success';
                resultDiv.textContent = result;

            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.textContent = `âŒ æ€§èƒ½æµ‹è¯•å¤±è´¥:\n${error.message}`;
            }
        }
    </script>
</body>
</html>
