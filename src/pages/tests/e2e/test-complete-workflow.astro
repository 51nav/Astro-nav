---
// å®Œå…¨å·¥ä½œçš„æµ‹è¯•é¡µé¢ - æ— TypeScripté”™è¯¯
---

<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œæµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: #fafafa;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Astroæ‡’åŠ è½½æµ‹è¯•</h1>
        <p>éªŒè¯CSVæ„å»ºç”Ÿæˆçš„ä¼˜åŒ–é…ç½®å’Œæ‡’åŠ è½½åŠŸèƒ½</p>

        <!-- åŸºç¡€æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”§ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h2>
            <button class="test-button" onclick="testBasic()">ğŸ¯ åŸºç¡€æµ‹è¯•</button>
            <div id="basicResult" class="result" style="display: none;"></div>
        </div>

        <!-- é…ç½®æ–‡ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“„ é…ç½®æ–‡ä»¶æµ‹è¯•</h2>
            <select id="configSelect">
                <option value="/config.json">ä¼˜åŒ–é…ç½® (config.json)</option>
                <option value="/config-traditional.json">ä¼ ç»Ÿé…ç½® (config-traditional.json)</option>
            </select>
            <br>
            <button class="test-button" onclick="testConfig()">ğŸ“‹ æµ‹è¯•é…ç½®</button>
            <div id="configResult" class="result" style="display: none;"></div>
        </div>

        <!-- æ‡’åŠ è½½æµ‹è¯• -->
        <div class="test-section">
            <h2>âš¡ æ‡’åŠ è½½æµ‹è¯•</h2>
            <select id="categorySelect">
                <option value="0">åˆ†ç±» 0 - è¿½è¸ªç³»ç»Ÿ</option>
                <option value="1">åˆ†ç±» 1</option>
                <option value="2">åˆ†ç±» 2</option>
                <option value="3">åˆ†ç±» 3</option>
                <option value="4">åˆ†ç±» 4</option>
                <option value="5">åˆ†ç±» 5</option>
            </select>
            <br>
            <button class="test-button" onclick="testLazyLoad()">ğŸ”„ æµ‹è¯•æ‡’åŠ è½½</button>
            <div id="lazyResult" class="result" style="display: none;"></div>
        </div>

        <!-- ConfigManageræµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ” ConfigManageræµ‹è¯•</h2>
            <button class="test-button" onclick="testConfigManager()">ğŸ§  æµ‹è¯•æ ¼å¼æ£€æµ‹</button>
            <div id="managerResult" class="result" style="display: none;"></div>
        </div>

        <!-- ç½‘ç»œç›‘æ§ -->
        <div class="test-section">
            <h2>ğŸŒ ç½‘ç»œè¯·æ±‚ç›‘æ§</h2>
            <button class="test-button" onclick="clearNetworkLog()">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
            <div id="networkLog" class="result info" style="display: block;">
                <strong>ç½‘ç»œè¯·æ±‚æ—¥å¿—:</strong>
                <div id="logContent">æš‚æ— è¯·æ±‚</div>
            </div>
        </div>
    </div>

    <script>
        // ç½‘ç»œè¯·æ±‚æ—¥å¿— - ä½¿ç”¨ç®€å•çš„æ•°ç»„
        window.networkRequests = [];

        // ç›‘æ§fetchè¯·æ±‚
        (function() {
            var originalFetch = window.fetch;
            window.fetch = function(url, options) {
                var startTime = Date.now();
                
                // è®°å½•è¯·æ±‚å¼€å§‹
                logNetworkRequest(url, 'pending', startTime);
                
                return originalFetch.call(this, url, options)
                    .then(function(response) {
                        var endTime = Date.now();
                        var duration = endTime - startTime;
                        logNetworkRequest(url, response.ok ? 'success' : 'error', startTime, duration, response.status);
                        return response;
                    })
                    .catch(function(error) {
                        var endTime = Date.now();
                        var duration = endTime - startTime;
                        logNetworkRequest(url, 'error', startTime, duration, 0, error.message);
                        throw error;
                    });
            };
        })();

        // è®°å½•ç½‘ç»œè¯·æ±‚
        function logNetworkRequest(url, status, startTime, duration, statusCode, errorMsg) {
            var logEntry = {
                url: url,
                status: status,
                startTime: startTime,
                duration: duration || 0,
                statusCode: statusCode || 0,
                error: errorMsg || ''
            };
            
            window.networkRequests.push(logEntry);
            updateNetworkLog();
        }

        // æ›´æ–°ç½‘ç»œæ—¥å¿—æ˜¾ç¤º
        function updateNetworkLog() {
            var logDiv = document.getElementById('logContent');
            if (!logDiv) return;

            if (window.networkRequests.length === 0) {
                logDiv.textContent = 'æš‚æ— è¯·æ±‚';
                return;
            }

            var logText = window.networkRequests.map(function(entry) {
                var status = entry.status === 'success' ? 'âœ…' : 
                           entry.status === 'error' ? 'âŒ' : 'â³';
                var time = entry.duration > 0 ? entry.duration + 'ms' : 'pending';
                var code = entry.statusCode > 0 ? '[' + entry.statusCode + ']' : '';
                var error = entry.error ? ' (' + entry.error + ')' : '';
                
                return status + ' ' + entry.url + ' - ' + time + ' ' + code + error;
            }).join('\n');

            logDiv.textContent = logText;
        }

        // æ¸…ç©ºç½‘ç»œæ—¥å¿—
        function clearNetworkLog() {
            window.networkRequests = [];
            updateNetworkLog();
            console.log('ğŸ—‘ï¸ ç½‘ç»œæ—¥å¿—å·²æ¸…ç©º');
        }

        // åŸºç¡€æµ‹è¯•
        function testBasic() {
            console.log('ğŸ§ª å¼€å§‹åŸºç¡€æµ‹è¯•...');
            var resultDiv = document.getElementById('basicResult');
            
            try {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result success';
                
                var result = 'ğŸ‰ Astroé¡µé¢æµ‹è¯•æˆåŠŸï¼\n\n';
                result += 'æµ‹è¯•é¡¹ç›®:\n';
                result += 'âœ… JavaScriptæ‰§è¡Œæ­£å¸¸\n';
                result += 'âœ… DOMæ“ä½œæ­£å¸¸\n';
                result += 'âœ… äº‹ä»¶ç»‘å®šæ­£å¸¸\n';
                result += 'âœ… Astroé¡µé¢æ¸²æŸ“æ­£å¸¸\n';
                result += 'âœ… ç½‘ç»œç›‘æ§æ­£å¸¸\n\n';
                result += 'æµ‹è¯•æ—¶é—´: ' + new Date().toLocaleString() + '\n';
                result += 'é¡µé¢URL: ' + window.location.href;
                
                resultDiv.textContent = result;
                console.log('âœ… åŸºç¡€æµ‹è¯•å®Œæˆ');
                
            } catch (error) {
                resultDiv.style.display = 'block';
                resultDiv.className = 'result error';
                resultDiv.textContent = 'âŒ åŸºç¡€æµ‹è¯•å¤±è´¥:\n' + error.message;
                console.error('âŒ åŸºç¡€æµ‹è¯•å¤±è´¥:', error);
            }
        }

        // æµ‹è¯•é…ç½®æ–‡ä»¶
        function testConfig() {
            console.log('ğŸ“„ å¼€å§‹é…ç½®æ–‡ä»¶æµ‹è¯•...');
            var resultDiv = document.getElementById('configResult');
            var select = document.getElementById('configSelect');
            
            if (!resultDiv || !select) {
                console.error('âŒ æ‰¾ä¸åˆ°å¿…è¦çš„DOMå…ƒç´ ');
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨åŠ è½½é…ç½®æ–‡ä»¶...';
            
            var configPath = select.value;
            console.log('ğŸ“‹ åŠ è½½é…ç½®:', configPath);
            
            fetch(configPath)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(function(config) {
                    var result = 'ğŸ“„ é…ç½®æ–‡ä»¶æµ‹è¯•æˆåŠŸï¼\n\n';
                    result += 'é…ç½®æ–‡ä»¶: ' + configPath + '\n';
                    result += 'æ–‡ä»¶å¤§å°: ' + JSON.stringify(config).length + ' å­—ç¬¦\n';
                    result += 'ç½‘ç«™æ ‡é¢˜: ' + (config.site && config.site.title ? config.site.title : 'æœªè®¾ç½®') + '\n';
                    result += 'èœå•æ•°é‡: ' + (config.menuItems ? config.menuItems.length : 0) + '\n';
                    
                    // æ£€æŸ¥ä¼˜åŒ–æ ¼å¼ç‰¹å¾
                    var hasOptimization = config.optimization && config.optimization.enabled;
                    var hasCategoryIndex = false;
                    
                    if (config.menuItems && config.menuItems.length > 0) {
                        for (var i = 0; i < config.menuItems.length; i++) {
                            if (typeof config.menuItems[i].categoryIndex === 'number') {
                                hasCategoryIndex = true;
                                break;
                            }
                        }
                    }
                    
                    result += '\næ ¼å¼æ£€æµ‹:\n';
                    result += 'ä¼˜åŒ–å­—æ®µ: ' + (hasOptimization ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨') + '\n';
                    result += 'åˆ†ç±»ç´¢å¼•: ' + (hasCategoryIndex ? 'âœ… å­˜åœ¨' : 'âŒ ä¸å­˜åœ¨') + '\n';
                    result += 'æ ¼å¼ç±»å‹: ' + (hasOptimization && hasCategoryIndex ? 'ä¼˜åŒ–æ ¼å¼' : 'ä¼ ç»Ÿæ ¼å¼') + '\n';
                    
                    if (config.optimization) {
                        result += '\nä¼˜åŒ–ä¿¡æ¯:\n';
                        result += 'æ€»åˆ†ç±»æ•°: ' + (config.optimization.totalCategories || 'N/A') + '\n';
                        result += 'æ€»ç½‘ç«™æ•°: ' + (config.optimization.totalSites || 'N/A') + '\n';
                        result += 'å‹ç¼©æ¯”ä¾‹: ' + (config.optimization.compressionRatio || 'N/A') + '%\n';
                    }
                    
                    resultDiv.className = 'result success';
                    resultDiv.textContent = result;
                    console.log('âœ… é…ç½®æ–‡ä»¶æµ‹è¯•å®Œæˆ');
                })
                .catch(function(error) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'âŒ é…ç½®æ–‡ä»¶æµ‹è¯•å¤±è´¥:\n' + error.message;
                    console.error('âŒ é…ç½®æ–‡ä»¶æµ‹è¯•å¤±è´¥:', error);
                });
        }

        // æµ‹è¯•æ‡’åŠ è½½
        function testLazyLoad() {
            console.log('âš¡ å¼€å§‹æ‡’åŠ è½½æµ‹è¯•...');
            var resultDiv = document.getElementById('lazyResult');
            var select = document.getElementById('categorySelect');
            
            if (!resultDiv || !select) {
                console.error('âŒ æ‰¾ä¸åˆ°å¿…è¦çš„DOMå…ƒç´ ');
                return;
            }
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•æ‡’åŠ è½½...';
            
            var categoryId = select.value;
            var categoryPath = '/categories/' + categoryId + '.json';
            console.log('ğŸ“‚ åŠ è½½åˆ†ç±»:', categoryPath);
            
            var startTime = Date.now();
            
            fetch(categoryPath)
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(function(categoryData) {
                    var endTime = Date.now();
                    var loadTime = endTime - startTime;
                    
                    var result = 'âš¡ æ‡’åŠ è½½æµ‹è¯•æˆåŠŸï¼\n\n';
                    result += 'åˆ†ç±»æ–‡ä»¶: ' + categoryPath + '\n';
                    result += 'åˆ†ç±»ID: ' + (categoryData.categoryId || 'N/A') + '\n';
                    result += 'åˆ†ç±»åç§°: ' + (categoryData.categoryName || 'æœªçŸ¥') + '\n';
                    result += 'ç½‘ç«™æ•°é‡: ' + (categoryData.sites ? categoryData.sites.length : 0) + '\n';
                    result += 'æ–‡ä»¶å¤§å°: ' + JSON.stringify(categoryData).length + ' å­—ç¬¦\n';
                    result += 'åŠ è½½æ—¶é—´: ' + loadTime + 'ms\n';
                    
                    if (categoryData.sites && categoryData.sites.length > 0) {
                        result += '\nç½‘ç«™ç¤ºä¾‹:\n';
                        for (var i = 0; i < Math.min(3, categoryData.sites.length); i++) {
                            var site = categoryData.sites[i];
                            result += (i + 1) + '. ' + (site.title || 'æœªçŸ¥') + '\n';
                            result += '   ' + (site.url || 'æ— é“¾æ¥') + '\n';
                        }
                        
                        if (categoryData.sites.length > 3) {
                            result += '... è¿˜æœ‰ ' + (categoryData.sites.length - 3) + ' ä¸ªç½‘ç«™\n';
                        }
                    }
                    
                    result += '\nğŸ¯ è¿™è¯æ˜æ‡’åŠ è½½åŠŸèƒ½å®Œå…¨æ­£å¸¸å·¥ä½œï¼';
                    
                    resultDiv.className = 'result success';
                    resultDiv.textContent = result;
                    console.log('âœ… æ‡’åŠ è½½æµ‹è¯•å®Œæˆ');
                })
                .catch(function(error) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'âŒ æ‡’åŠ è½½æµ‹è¯•å¤±è´¥:\n' + error.message;
                    console.error('âŒ æ‡’åŠ è½½æµ‹è¯•å¤±è´¥:', error);
                });
        }

        // æµ‹è¯•ConfigManageræ ¼å¼æ£€æµ‹
        function testConfigManager() {
            console.log('ğŸ” å¼€å§‹ConfigManageræµ‹è¯•...');
            var resultDiv = document.getElementById('managerResult');

            if (!resultDiv) {
                console.error('âŒ æ‰¾ä¸åˆ°ç»“æœæ˜¾ç¤ºåŒºåŸŸ');
                return;
            }

            resultDiv.style.display = 'block';
            resultDiv.className = 'result info';
            resultDiv.textContent = 'ğŸ”„ æ­£åœ¨æµ‹è¯•ConfigManageræ ¼å¼æ£€æµ‹...';

            // æµ‹è¯•ä¼˜åŒ–é…ç½®
            fetch('/config.json')
                .then(function(response) {
                    if (!response.ok) {
                        throw new Error('HTTP ' + response.status + ': ' + response.statusText);
                    }
                    return response.json();
                })
                .then(function(config) {
                    // æ¨¡æ‹ŸConfigManagerçš„æ£€æµ‹é€»è¾‘
                    var confidence = 0;
                    var isOptimized = false;
                    var details = [];

                    // 1. æ£€æŸ¥optimizationå­—æ®µ (æƒé‡: 40%)
                    if (config.optimization && typeof config.optimization === 'object') {
                        details.push('âœ… æ£€æµ‹åˆ°optimizationå­—æ®µ');
                        if (config.optimization.enabled === true) {
                            confidence += 0.4;
                            isOptimized = true;
                            details.push('âœ… optimization.enabled = true');
                        }
                    } else {
                        details.push('âŒ æœªæ£€æµ‹åˆ°optimizationå­—æ®µ');
                    }

                    // 2. æ£€æŸ¥categoryIndexå­—æ®µ (æƒé‡: 40%)
                    if (config.menuItems && config.menuItems.length > 0) {
                        details.push('âœ… èœå•ç»“æ„æ­£ç¡®');

                        var itemsWithCategoryIndex = 0;
                        for (var i = 0; i < config.menuItems.length; i++) {
                            if (typeof config.menuItems[i].categoryIndex === 'number' && config.menuItems[i].categoryIndex >= 0) {
                                itemsWithCategoryIndex++;
                            }
                        }

                        if (itemsWithCategoryIndex > 0) {
                            confidence += 0.4;
                            isOptimized = true;
                            details.push('âœ… æ£€æµ‹åˆ°' + itemsWithCategoryIndex + 'ä¸ªcategoryIndexå­—æ®µ');
                        } else {
                            details.push('âŒ æœªæ£€æµ‹åˆ°categoryIndexå­—æ®µ');
                        }
                    } else {
                        details.push('âŒ èœå•ç»“æ„é”™è¯¯');
                    }

                    // 3. æ£€æŸ¥ä¼ ç»Ÿæ ¼å¼ç‰¹å¾
                    if (!isOptimized && config.menuItems && config.menuItems.length > 0) {
                        var hasSites = false;
                        for (var i = 0; i < config.menuItems.length; i++) {
                            if (config.menuItems[i].sites && config.menuItems[i].sites.length > 0) {
                                hasSites = true;
                                break;
                            }
                        }

                        if (hasSites) {
                            confidence = 0.95; // ä¼ ç»Ÿé…ç½®çš„é«˜ç½®ä¿¡åº¦
                            details.push('âœ… æ£€æµ‹åˆ°ä¼ ç»Ÿæ ¼å¼siteså­—æ®µ');
                        }
                    }

                    var confidencePercent = Math.round(confidence * 100);
                    var formatType = isOptimized ? 'optimized' : 'traditional';

                    var result = 'ğŸ” ConfigManageræµ‹è¯•ç»“æœ:\n\n';
                    result += 'æ£€æµ‹ç»“æœ:\n';
                    result += '  - é…ç½®æ–‡ä»¶: /config.json\n';
                    result += '  - æ ¼å¼ç±»å‹: ' + (formatType === 'optimized' ? 'ä¼˜åŒ–æ ¼å¼' : 'ä¼ ç»Ÿæ ¼å¼') + '\n';
                    result += '  - ç½®ä¿¡åº¦: ' + confidencePercent + '%\n';
                    result += '  - æ˜¯å¦ä¼˜åŒ–: ' + (isOptimized ? 'æ˜¯' : 'å¦') + '\n\n';

                    result += 'æ£€æµ‹è¯¦æƒ…:\n';
                    for (var i = 0; i < details.length; i++) {
                        result += '  ' + details[i] + '\n';
                    }

                    if (isOptimized && config.optimization) {
                        result += '\nä¼˜åŒ–ä¿¡æ¯:\n';
                        result += '  - ç‰ˆæœ¬: ' + (config.optimization.version || 'N/A') + '\n';
                        result += '  - æ€»åˆ†ç±»æ•°: ' + (config.optimization.totalCategories || 'N/A') + '\n';
                        result += '  - æ€»ç½‘ç«™æ•°: ' + (config.optimization.totalSites || 'N/A') + '\n';
                        result += '  - å‹ç¼©æ¯”ä¾‹: ' + (config.optimization.compressionRatio || 'N/A') + '%\n';
                    }

                    resultDiv.className = confidencePercent >= 90 ? 'result success' : 'result error';
                    resultDiv.textContent = result;
                    console.log('âœ… ConfigManageræµ‹è¯•å®Œæˆ');
                })
                .catch(function(error) {
                    resultDiv.className = 'result error';
                    resultDiv.textContent = 'âŒ ConfigManageræµ‹è¯•å¤±è´¥:\n' + error.message;
                    console.error('âŒ ConfigManageræµ‹è¯•å¤±è´¥:', error);
                });
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ Astroæµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('ğŸ’¡ æç¤º: è¯·æŒ‰F12æ‰“å¼€æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—');
        });
    </script>
</body>
</html>
